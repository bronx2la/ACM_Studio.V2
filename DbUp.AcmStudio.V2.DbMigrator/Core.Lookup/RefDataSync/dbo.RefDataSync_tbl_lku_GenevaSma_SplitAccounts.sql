use ACM_Studio_V2
go

truncate table tbl_lku_GenevaSMA_SplitAccounts

set identity_insert dbo.tbl_lku_GenevaSMA_SplitAccounts on

merge into dbo.tbl_lku_GenevaSMA_SplitAccounts target
using
  (
    values
      (1, '11207', '2015Q4'),
      (2, '11207', '2016Q1'),
      (3, '11207', '2016Q2'),
      (4, '11207', '2016Q3'),
      (5, '11210', '2015Q4'),
      (6, '11210', '2016Q1'),
      (7, '11210', '2016Q2'),
      (8, '11210', '2016Q3'),
      (9, '11211', '2015Q4'),
      (10, '11211', '2016Q1'),
      (11, '11211', '2016Q2'),
      (12, '11211', '2016Q3'),
      (13, '11212', '2015Q4'),
      (14, '11212', '2016Q1'),
      (15, '11212', '2016Q2'),
      (16, '11212', '2016Q3'),
      (17, '11213', '2015Q4'),
      (18, '11213', '2016Q1'),
      (19, '11213', '2016Q2'),
      (20, '11213', '2016Q3'),
      (21, '11214', '2015Q4'),
      (22, '11214', '2016Q1'),
      (23, '11214', '2016Q2'),
      (24, '11214', '2016Q3'),
      (25, '11218', '2015Q4'),
      (26, '11218', '2016Q1'),
      (27, '11218', '2016Q2'),
      (28, '11218', '2016Q3'),
      (29, '11224', '2015Q4'),
      (30, '11224', '2016Q1'),
      (31, '11224', '2016Q2'),
      (32, '11224', '2016Q3'),
      (33, '11225', '2015Q4'),
      (34, '11225', '2016Q1'),
      (35, '11225', '2016Q2'),
      (36, '11225', '2016Q3'),
      (37, '11229', '2015Q4'),
      (38, '11229', '2016Q1'),
      (39, '11229', '2016Q2'),
      (40, '11229', '2016Q3'),
      (41, '11230', '2015Q4'),
      (42, '11230', '2016Q1'),
      (43, '11230', '2016Q2'),
      (44, '11230', '2016Q3'),
      (45, '11232', '2015Q4'),
      (46, '11232', '2016Q1'),
      (47, '11232', '2016Q2'),
      (48, '11232', '2016Q3'),
      (49, '11273', '2015Q4'),
      (50, '11273', '2016Q1'),
      (51, '11273', '2016Q2'),
      (52, '11273', '2016Q3'),
      (53, '11274', '2015Q4'),
      (54, '11274', '2016Q1'),
      (55, '11274', '2016Q2'),
      (56, '11274', '2016Q3'),
      (57, '11205', '2015Q4'),
      (58, '11205', '2016Q1'),
      (59, '11205', '2016Q2'),
      (60, '11205', '2016Q3'),
      (61, '11207', '2017Q3'),
      (62, '11210', '2017Q3'),
      (63, '11211', '2017Q3'),
      (64, '11212', '2017Q3'),
      (65, '11213', '2017Q3'),
      (66, '11214', '2017Q3'),
      (67, '11218', '2017Q3'),
      (68, '11224', '2017Q3'),
      (69, '11225', '2017Q3'),
      (70, '11229', '2017Q3'),
      (71, '11230', '2017Q3'),
      (72, '11232', '2017Q3'),
      (73, '11273', '2017Q3'),
      (74, '11274', '2017Q3'),
      (75, '11207', '2018Q1'),
      (76, '11210', '2018Q1'),
      (77, '11211', '2018Q1'),
      (78, '11212', '2018Q1'),
      (79, '11213', '2018Q1'),
      (80, '11214', '2018Q1'),
      (81, '11218', '2018Q1'),
      (82, '11224', '2018Q1'),
      (83, '11225', '2018Q1'),
      (84, '11229', '2018Q1'),
      (85, '11230', '2018Q1'),
      (86, '11232', '2018Q1'),
      (87, '11273', '2018Q1'),
      (88, '11274', '2018Q1')
  ) as source
  (SplitAccountIid, PortfolioCode, ReportingPeriod)
on (target.SplitAccountIid = source.SplitAccountIid)

when matched and
  target.PortfolioCode <> source.PortfolioCode
  or target.ReportingPeriod <> source.ReportingPeriod then
  update
  set
    target.PortfolioCode = source.PortfolioCode,
    target.ReportingPeriod = source.ReportingPeriod

when not matched then
  insert
  (SplitAccountIid, PortfolioCode, ReportingPeriod)
  values
    (source.SplitAccountIid, source.PortfolioCode, source.ReportingPeriod)

when not matched by source then
  delete;

set identity_insert dbo.tbl_lku_GenevaSMA_SplitAccounts off